# Задание 33.3. Генераторы коллекций. list, dict, set comprehensions

## Блок урока
«Dict comprehensions» позволяет быстро собирать словари с вычисляемыми значениями и фильтрами. Это важно для лаконичной подготовки конфигураций.

## Условие задачи
**Сложность**: <span style="color: #c62828">● сложный</span>. примерное время: 15–20 минут

Есть список `clusters`, где каждый элемент — словарь:
- `"name"`: название кластера
- `"nodes"`: список словарей `{ "host": str, "latency": float, "region": str }`
- `"sla"`: максимально допустимая средняя задержка (float)

Построй одним dict comprehension словарь `cluster_health`, где ключ — имя кластера, а значение — словарь вида `{ "avg_latency": <float>, "regions": <set> }`. Включай только кластеры, у которых средняя задержка по всем узлам не превышает `sla` и количество узлов не меньше четырёх. Поле `"regions"` должно содержать множество регионов узлов (используй set comprehension внутри выражения).

## Пример входных данных
```
clusters = [
    {
        "name": "core-eu",
        "sla": 90.0,
        "nodes": [
            {"host": "eu-1", "latency": 80.0, "region": "fra"},
            {"host": "eu-2", "latency": 85.0, "region": "ams"},
            {"host": "eu-3", "latency": 70.0, "region": "fra"},
            {"host": "eu-4", "latency": 88.0, "region": "waw"}
        ]
    },
    {
        "name": "edge-us",
        "sla": 60.0,
        "nodes": [
            {"host": "us-1", "latency": 55.0, "region": "iad"},
            {"host": "us-2", "latency": 75.0, "region": "iad"},
            {"host": "us-3", "latency": 65.0, "region": "dfw"}
        ]
    }
]
```

## Пример выходных данных
```
{
    'core-eu': {
        'avg_latency': 80.75,
        'regions': {'fra', 'ams', 'waw'}
    }
}
```

## Критерии успешного выполнения
- Выражение dict comprehension формирует весь словарь `cluster_health` без внешних циклов.
- Средняя задержка рассчитывается как сумма делённая на количество узлов и сравнивается со `sla`.
- Количество узлов проверяется до включения кластера в результат.
- Поле `regions` строится set comprehension-ом внутри выражения.
- Исходный список `clusters` не изменяется.

## Подсказки
- Подготовь вспомогательные переменные: например, функцию для вычисления средней задержки.
- Пересечение условий удобно разместить в части `if` после comprehension.
- Используй `round(value, 2)` при необходимости вывода, но не искажай исходные данные.
- Для множества регионов можно написать `{node["region"] for node in cluster["nodes"]}`.

## Частые ошибки и ограничения
- Попытка создавать словарь в цикле с `cluster_health[cluster["name"]] = ...` нарушает требования.
- Нельзя забывать проверять количество узлов — условие `len(nodes) >= 4` обязательно.
- Не добавляй дополнительные структуры в списках — держи линии списков не длиннее пяти пунктов.
